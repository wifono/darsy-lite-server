import{ad as u,ae as r}from"./index.1eed2d83.js";import{api as p}from"./axios.eb2250c4.js";import{g}from"./ClosePopup.6300f75c.js";const m={events:{length:60,doubleClickEventsLength:15,overlapping:!1}},v=g(),h=async a=>{const o=v.rooms.find(t=>t._id===a);return o?o.color:"#eb67c7"},b=u("Events",{state:()=>({subject:null,start:null,end:null,location:null,organizer:null,day:null,eventModal:!1,editEventModal:!1,eventId:null,events:[],addFormVisible:!1,useCustomValues:!1,start:"",startHours:"00",startMinutes:"00",otherEmployeeEvent:!1,otherEmployee:""}),getters:{},actions:{async getEvents(){var a,o;try{const t=JSON.parse(localStorage.getItem("credentials")),l=(a=t==null?void 0:t.user)==null?void 0:a.companyId,c=(o=t==null?void 0:t.user)==null?void 0:o.role,i=await p.get("event",{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});console.log("Events fetched:",i.data.data);const s=n=>n.map(e=>({id:e._id,title:e.subject,start:new Date(e.start*1e3).toISOString().slice(0,16).replace("T"," "),end:new Date(e.end*1e3).toISOString().slice(0,16).replace("T"," "),location:e.locationName,locationId:e.location,description:e.organizerName,company:e.companyId,isEditable:!0,disableDND:["month","week","day"],disableResize:["month","week","day"],additionalClasses:"drag",color:h(e.location),calendarId:`${e.location}`,organizer:e.organizer}));c==="admin"?(this.events=s(i.data.data),console.log("jetotamm",this.events)):this.events=s(i.data.data.filter(n=>n.companyId===l))}catch{r.create({message:"Chyba pri z\xEDskavan\xED udalost\xED.",color:"warning",position:"top"})}},async createEvent(){const a=Date.parse(`${this.day}T${this.start}Z`)/1e3,o=Date.parse(`${this.day}T${this.end}Z`)/1e3,t=JSON.parse(localStorage.getItem("credentials")),l=m.events;if(console.log(l.overlapping),this.events.some(n=>{const e=Date.parse(n.start.replace(" ","T")+"Z")/1e3,d=Date.parse(n.end.replace(" ","T")+"Z")/1e3;return n.locationId!==this.location.value?!1:a>=e&&a<d||o>e&&o<=d||a<=e&&o>=d})){r.create({message:"Udalos\u0165 sa nem\xF4\u017Ee vytvori\u0165, preto\u017Ee sa prekr\xFDva s existuj\xFAcou udalos\u0165ou v tejto miestnosti.",color:"negative",position:"top"});return}const c=this.otherEmployeeEvent?this.otherEmployee.value:t.user._id,i={subject:this.subject,start:a.toString(),end:o.toString(),location:this.location.value,organizer:c,company:t.user.companyId||""};try{const s=await p.post("event",i,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});s.status===201?s.data.status==="error"&&s.data.code===400?r.create({message:"Nedostatok dostupn\xE9ho \u010Dasu na vytvorenie udalosti",color:"negative",position:"top"}):(r.create({message:"Udalos\u0165 vytvoren\xE1",color:"positive",position:"top"}),this.events.push(s.data),await this.getEvents(),this.addFormVisible=!1):r.create({message:"Chyba pri vytv\xE1ran\xED udalosti.",color:"negative",position:"top"})}catch(s){console.error("Error during event creation:",s),r.create({message:"Chyba pri vytv\xE1ran\xED udalosti.",color:"negative",position:"top"})}},async updateEvent(){try{const a=Date.parse(`${this.day}T${this.start}Z`)/1e3,o=Date.parse(`${this.day}T${this.end}Z`)/1e3,t={subject:this.subject,start:a.toString(),end:o.toString(),location:this.location.value};(await p.patch(`/event/${this.eventId}`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).status===200&&(r.create({message:"Udalos\u0165 upraven\xE1.",color:"positive",position:"top"}),this.editEventModal=!1,this.eventModal=!1,await this.getEvents())}catch(a){r.create({message:"Chyba pri \xFAprave udalosti.",color:"negative",position:"top"}),console.error(a)}}}});export{m as c,b as u};
